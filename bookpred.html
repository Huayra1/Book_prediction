<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>8977aa70db994695bc261028a5ab8f5b</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="78ea769c" class="cell markdown">
<h1 id="average-book-rating-prediction">Average book rating
prediction</h1>
<p>By Ouc-houang Fogoum Philippe Jacques and Håvard Næss</p>
</div>
<div id="b5fb952e" class="cell markdown">
<h2 id="1-abstract">1. Abstract</h2>
<h2 id="2-introduction">2. Introduction</h2>
<h2 id="3-problem-statement-and-methodology">3. Problem statement and
methodology</h2>
<h2 id="4-the-data">4. The data</h2>
<h2 id="5-experimental-setup">5. Experimental setup</h2>
<h2 id="6-results">6. Results</h2>
<h2 id="7-analysis-and-discussion">7. Analysis and discussion</h2>
<h2 id="8-conclusion">8. Conclusion</h2>
<h2 id="9-the-code-with-comments-explanations-and-partial-analysis">9.
The code, with comments, explanations and partial analysis</h2>
</div>
<div id="b4608655" class="cell markdown">
<h2 id="1-abstract">1. Abstract</h2>
<p>This project presents a novel approach to predicting average book
ratings using machine learning model based on data collected from <a
href="http://www.goodreads.com"
class="uri">http://www.goodreads.com</a>. The primary objective is to
develop a reliable and accurate prediction model that considers various
book features, such as author, genre, publication year, and number of
pages, to estimate the average rating a book is likely to receive. <br>
We employ severay preprocessing techiniques to clean and organize the
data, and evaluate the performance of multiple machine learning
algorithms, including linear regression, polynomial regression, gradient
boosting, gradient penalty and random forest.</p>
</div>
<div id="94b71a55" class="cell markdown">
<h2 id="2-introduction">2. Introduction</h2>
<p>The immense growth of online platforms and social networks has
resulted in a surge of user-generatged content, including book reviews
and ratings. Goodreads.com, on of the largest book review websites
provides a rich source of information on millions of books, along with
their ratings, reviews, and metadata. <br> Predicting book ratings is an
important task for book recommendations systems, as it helps users
discover new and interesting books to read, and can aid publishers in
identifying potential bestsellers. Futhermore, understanding the factors
can contribute to higher book ratings can provide valueable insights
into reader preferences and the dynamics of the publishing industry.</p>
<p>In recent years, machine learning techniques have been increasingly
employed to predict book ratings based on various features, such as
textual content, metadata, and user preferences. Several studies have
demonstrated the effectiveness of machine learning models in predicting
book ratings using textual analysis of bok summaries or reviews, and
metadata such as author, genre, and publication year. However, there is
still room for improvement in the prediction accuracy and
generalizability of these models.</p>
<p>In this project, we aim to develop a simple, yet effetive machine
learning model for predicting average book ratings using data collected
from goodreads. com. We first preprocess and clean the data, and then
perform feature engineering to create meaningul input features for our
model. Next, we explore multiple machine leanring algorithms to dientify
the best performing model for our task. <br> We also evaluate the
performance of our proposed model using appropriate evaluation metrics,
such as <span class="math inline"><em>R</em><sup>2</sup></span> and
p-values, and compare it to baseline models.</p>
</div>
<div id="717b6729" class="cell markdown">
<h2 id="3-problem-statement-and-methodology">3. Problem statement and
methodology</h2>
<h3 id="3a-problem-statement">3a. Problem statement</h3>
<p>The problem this study aims to address is the prediction of average
book ratings based on information available on goodreads.com. <br>
Accurate predictions can enhance the performance of book recommendation
systems and provide insights into reader preferences and teh factors
contributing to book success. The challenge lien is selecting and
engineering relevant featrues and employing an appropriate machine
learning model to achieve high prediction accuracy.</p>
<h3 id="3b-methodology">3b. Methodology</h3>
<h4 id="3bi-data-collection">3b(I). Data collection</h4>
<p>We have been provided with a dataset extracted from goodreads.com.
<br> The dataset contains just over <span
class="math inline">11 000</span> books. <br> The collected data
includes book metadata, such as title, authors, average rating, isbn,
isbn13, language code, number of pages, number of ratings, number of
text reviews, publication date and publisher</p>
<p>The date of the data extraction is unknown, so for this project, we
have assumed it to be at the end of December 31st 2022.</p>
<h4 id="3bii-data-preprocessing">3b(II). Data preprocessing</h4>
<p>The raw data is preprocessed to remove any inconsistencies, outliers,
or missing values that could negatively impact the performance of the
machine learning models. <br> Categorical variables are encoded using
appropriate encoding if seen fit. <br> No natural language processing
techiniques are applied for futher analysis of text-based variables.</p>
<h4 id="3biii-feature-engineering">3b(III). Feature engineering</h4>
<p>We engineer new features based on the collected data to capture
potential relationships between the variables and the aveerage book
ratings. These features may include interaction terms, aggregated
statistics or non-linear variable transformation. <br> Feature selection
techniques, such as correlation analysis and mutual information are
employed to identify the most relevant features for the prediction
task.</p>
<h4 id="3biv-model-selection-and-evaluation">3b(IV). Model selection and
evaluation</h4>
<p>We experiment with various machine learning algorithms, incliding
linear regression, random forest, and gradient boostying, to identify
the model with the best performance in preicting average book ratings.
The models are trained on a training dataset and their performance is
evaluated using a separate test dataset.</p>
<p>The evaltuation metrics used to copare the models include <span
class="math inline"><em>R</em><sup>2</sup></span>, Mean Squared Error
and p-values for individual features. Cross-validation techniques are
employed to ensure erobust and generalizable results.</p>
</div>
<div id="c8aaff16" class="cell markdown">
<h2 id="4-the-data">4. The data</h2>
<p>The dataset contains information about books, collected from
Goodreads.com. It includes the following variables:</p>
<ul>
<li>bookID: An unique identification number for each book.</li>
<li>title: The title of the book.</li>
<li>authors: A list of authors who contributed to the book.</li>
<li>average_rating: The average rating given by users on a scale of 1 to
5, where 1 is the lowest and 5 is the highest.</li>
<li>isbn: The International Standard Book Number (ISBN) is a unique
identifier for the book. It is a 10-digit number.</li>
<li>isbn13: The 13-digit version of the ISBN, which was introduced in
2007 to accommodate the growing number of published books.</li>
<li>language_code: The language in which the book was written,
represented by a standard language code (e.g., 'eng' for English, 'fre'
for French).</li>
<li>num_pages: The total number of pages in the book.</li>
<li>ratings_count: The total number of user ratings the book has
received on Goodreads.com.</li>
<li>text_reviews_count: The total number of text reviews the book has
received on Goodreads.com.</li>
<li>publication_date: The date when the book was first published, in the
format 'month day, year'.</li>
<li>publisher: The name of the company that published the book.</li>
</ul>
<p>This dataset provides a comprehensive overview of various aspects of
the books, such as their popularity, user ratings, and publication
details, which can be used to analyze and predict book ratings based on
the provided features.</p>
</div>
<div id="dacb103d" class="cell markdown">
<h2 id="5-experimental-setup">5. Experimental setup</h2>
<h3 id="5a-data-preprocessing">5a. Data preprocessing</h3>
<p>Before training the machine learning model, the raw data was
preprcessed to ensure its quality and compatibility with the model. This
step included cleaning and handling missing values, endoding categorical
variables, and <strong>normalizing numerical features</strong>. The
dataset was then divided into two parts: training data (X_train,
y_train) and test data (X_test, y_test), using a specific proportion,
which is our case is 80% for training and 20% for testing.</p>
<h3 id="5b-model-selection">5b. Model selection</h3>
<p>We experimented with different machine learning algorithms to
determine the best-performing model for our dataset.</p>
<h3 id="5c-feature-selection">5c. Feature selection</h3>
<p>To identify the most relevant features for predicting average book
ratins, we employed a feature selecting technique of recursive feature
elimination, to rank and select the top features of our model.</p>
<h3 id="5d-model-evaluation">5d. Model evaluation</h3>
<p>The performance of the model was evaluated using various metrics,
such as Mean Squared Error (MSE), <span
class="math inline"><em>R</em><sup>2</sup></span> and p-values to ensure
the model's robustness and generalization capabilities.</p>
<h3 id="5e-model-interpretation">5e. Model interpretation</h3>
<p>Fin final model's feature importances were analyzed to gain insights
into the relationships between the features and the targer variable.
This helped us understand which factors significantly influenced the
average book ratings.</p>
<h3 id="5f-validation-and-prediction">5f. Validation and prediction</h3>
<p>The trained model was then applied to the test dataset to validate
its performance and generate predictions for average book ratings.</p>
<p>By followning this experimental setup, we aimed to build a robuset
and accurate machine learning model to predict average book ratings
based on the features provided in the dataset.</p>
</div>
<div id="07cac976" class="cell markdown">
<h2 id="6-results">6. Results</h2>
<p>By running this model 1000 times on different distributions of test
and training data, we found that the LightGBM regression model yielded a
mean <span class="math inline"><em>R</em><sup>2</sup></span> value of
0.102 and a Mean Squared Error (MSE) of 0.077. The <span
class="math inline"><em>R</em><sup>2</sup></span> value indicates that
approximately 10% of the variance in the average book ratings can be
explained by the features included in the model. While this result
demonstrates that the model has some predictive power, it also suggests
that there may be other factors not captured by the features in the
dataset that could have a more significant impact on the average book
ratings.</p>
<p>The MSE of 0.077 indicates the average squared difference between the
predicted and actual book ratings. This metric provides a quantitative
measure of the model's accuracy. In this case, the MSE value suggests
that the model's predictions are, on average, reasonably close to the
true ratings. However, it is essential to consider the context and scale
of the problem to determine whether this level of accuracy is sufficient
for the specific application.</p>
<p>Overall, the LightGBM regression model demonstrates a modest ability
to predict average book ratings based on the given features. Further
investigation could involve exploring additional features or refining
the model to improve its predictive performance.</p>
</div>
<div id="b299a4d8" class="cell markdown">
<h2 id="7-analysis-and-discussion">7. Analysis and discussion</h2>
<p>Upon analyzing the results, we observed that the LightGBM model
outperformed the other models in predicting the average book ratings. It
achieved the highest mean <span
class="math inline"><em>R</em><sup>2</sup></span> value of 0.099 and the
lowest mean MSE value of 0.079 over a round of 30 estimations based on
different distributions of the data. This suggests that the LightGBM
model is more effective at capturing the underlying patterns in the data
compared to the other models we tested.</p>
<p>The feature selection process, which involved iteratively removing
variables with high p-values, allowed us to identify a final set of
explanatory variables that were more significantly correlated with the
average_rating. The final set of variables included:</p>
<ul>
<li>log_days_since_published</li>
<li>log_r_count</li>
<li>log_t_count</li>
<li>log_r_count_per_log_day</li>
<li>log_t_count_per_log_day</li>
<li>is_eng</li>
<li>log_t_count_per_num_pages</li>
<li>num_pages</li>
</ul>
<p>We also discovered that both the <span
class="math inline"><em>R</em><sup>2</sup></span> and the MSE are
normally distributed. <br> This indicates that the model performance is
stable and centered around the mean <span
class="math inline"><em>R</em><sup>2</sup></span> and MSE values. This
means that the model is consistently providing similar results across
different runs, which is generally a good sign. <br> With the normal
distribution of these values, one can have more confidence in the mean
performance of the model's representative measures. This helps in
estimating the model's performance on unseen data. <br> This
distribution of values can also give an insight into how much room there
is for model imporvement. If the distribution is narrow, it might
suggest that the model is already perfroming well, and there may not be
significant room for imporvement. conversely, if the distribution is
wide, it could indicate that further improvements can be made by
tweaking hyperpareamteres, adding new features, or trying different
algorithms. <br> On the other hand, a wide distribution can give an
indication of robustness of the model to variations in the training
data. A narrow distribution could siggest that the model is less
sensitive to changes in the training set, wile a wide distribution might
indicate that the model performance can vary significantly depending on
the data it is trained on.</p>
<p>However, it is important to note that the relatively low <span
class="math inline"><em>R</em><sup>2</sup></span> values for all models
indicate that there is still room for improvement in predicting book
ratings. The selected features might not fully capture the variations in
the target variable, suggesting that further exploration of other
features or more advanced models might be beneficial.</p>
</div>
<div id="653bb9a5" class="cell markdown">
<h2 id="8-conclusion">8. Conclusion</h2>
<p>In conclusion, our study aimed to predict book ratings using various
machine learning models and a dataset containing features such as the
number of pages, ratings count, text reviews count, and others. Among
the models tested, the LightGBM model demonstrated the best performance
in terms of <span class="math inline"><em>R</em><sup>2</sup></span> and
MSE values. The final model included a set of explanatory variables that
showed a higher correlation with the average_rating compared to the
initial set of features.</p>
<p>Our findings can provide insights for publishers, authors, and
readers in understanding the factors that contribute to book ratings.
However, the relatively low <span
class="math inline"><em>R</em><sup>2</sup></span> values indicate that
the current model could benefit from further refinement, such as the
inclusion of additional data, exploration of other features, or the use
of more advanced models.</p>
<p>Future research could build upon our work by investigating other
features, such as book genres or author-specific characteristics, to
improve predictive performance. Additionally, more advanced machine
learning techniques, such as deep learning or ensemble methods, could be
explored to enhance the model's ability to capture the complexities of
the book rating prediction problem.</p>
</div>
<div id="b1292f8d" class="cell markdown">
<h2 id="9-reproduction-of-results">9. Reproduction of results</h2>
<p>The complete repository with necessary files and documentation can be
found here: <a href="https://github.com/Huayra1/Book_prediction"
class="uri">https://github.com/Huayra1/Book_prediction</a></p>
<p>The following .yml file will create a conda virtual environment with
all necessary packages installed. <br> To generate this environment,
save the file as bookpred.yml <br> and run the command : <strong>conda
env create -f bookpred.yml</strong> in a conda environment</p>
<pre><code>name: bookpred
channels:
  - defaults
  - conda-forge
dependencies:
  - python=3.11.0
  - jupyter=1.0.0
  - pandas=1.5.3
  - matplotlib=3.7.1
  - seaborn=0.12.2
  - scipy=1.10.1
  - statsmodels=0.13.5
  - scikit-learn=1.2.2
  - lightgbm=3.3.5</code></pre>
<p>The .yml file can also be found here: <a
href="https://github.com/Huayra1/Book_prediction/blob/main/bookpred.yml"
class="uri">https://github.com/Huayra1/Book_prediction/blob/main/bookpred.yml</a></p>
<p>The dataset for the project can be found here: <a
href="https://github.com/Huayra1/Book_prediction/blob/main/books.csv"
class="uri">https://github.com/Huayra1/Book_prediction/blob/main/books.csv</a></p>
<p>A pdf of this report including script can be found here: <a
href="https://github.com/Huayra1/Book_prediction/blob/main/bookpred.pdf"
class="uri">https://github.com/Huayra1/Book_prediction/blob/main/bookpred.pdf</a></p>
<p>An html file of this report including script can be found here: <a
href="https://github.com/Huayra1/Book_prediction/blob/main/bookpred.html"
class="uri">https://github.com/Huayra1/Book_prediction/blob/main/bookpred.html</a></p>
</div>
<div id="627c4203" class="cell markdown">
<h2 id="10-the-code-with-comments-explanations-and-partial-analysis">10.
The code, with comments, explanations and partial analysis</h2>
</div>
<div id="277a700a" class="cell markdown">
<p>We start by importing the necessary libraries</p>
</div>
<div id="f355a850" class="cell code" data-execution_count="2">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy <span class="im">as</span> sc</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score, mean_squared_error</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVR</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression, Ridge, Lasso, BayesianRidge</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lightgbm <span class="im">import</span> LGBMRegressor</span></code></pre></div>
</div>
<div id="545041ec" class="cell markdown">
<p>We then import the dataset into a pandas dataframe, and remove those
books who's data does not match the desired structure.</p>
<p>We then remove those books who's rating_count is 0 as that means they
have no rating, which is pointless to us as the response variable is the
average_rating.</p>
</div>
<div id="d993c43e" class="cell code" data-execution_count="3">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&quot;ignore&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="vs">r&quot;datasets\books.csv&quot;</span>,sep<span class="op">=</span><span class="st">&quot;,&quot;</span>, error_bad_lines<span class="op">=</span><span class="va">False</span>, index_col<span class="op">=</span><span class="st">&quot;bookID&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.replace(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.ratings_count <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">&#39;num_pages&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">isinstance</span>(x, (<span class="bu">int</span>, <span class="bu">float</span>)))]</span></code></pre></div>
<div class="output stream stderr">
<pre><code>Skipping line 3350: expected 12 fields, saw 13
Skipping line 4704: expected 12 fields, saw 13
Skipping line 5879: expected 12 fields, saw 13
Skipping line 8981: expected 12 fields, saw 13

</code></pre>
</div>
</div>
<div id="78db638c" class="cell markdown">
<p>What we will do now is get an idea of what the dataset looks
like.</p>
</div>
<div id="877b41a3" class="cell code" data-execution_count="25">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="25">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>authors</th>
      <th>average_rating</th>
      <th>isbn</th>
      <th>isbn13</th>
      <th>language_code</th>
      <th>num_pages</th>
      <th>ratings_count</th>
      <th>text_reviews_count</th>
      <th>publication_date</th>
      <th>publisher</th>
    </tr>
    <tr>
      <th>bookID</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Harry Potter and the Half-Blood Prince (Harry ...</td>
      <td>J.K. Rowling/Mary GrandPré</td>
      <td>4.57</td>
      <td>0439785960</td>
      <td>9780439785969</td>
      <td>eng</td>
      <td>652</td>
      <td>2095690</td>
      <td>27591</td>
      <td>9/16/2006</td>
      <td>Scholastic Inc.</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Harry Potter and the Order of the Phoenix (Har...</td>
      <td>J.K. Rowling/Mary GrandPré</td>
      <td>4.49</td>
      <td>0439358078</td>
      <td>9780439358071</td>
      <td>eng</td>
      <td>870</td>
      <td>2153167</td>
      <td>29221</td>
      <td>9/1/2004</td>
      <td>Scholastic Inc.</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Harry Potter and the Chamber of Secrets (Harry...</td>
      <td>J.K. Rowling</td>
      <td>4.42</td>
      <td>0439554896</td>
      <td>9780439554893</td>
      <td>eng</td>
      <td>352</td>
      <td>6333</td>
      <td>244</td>
      <td>11/1/2003</td>
      <td>Scholastic</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Harry Potter and the Prisoner of Azkaban (Harr...</td>
      <td>J.K. Rowling/Mary GrandPré</td>
      <td>4.56</td>
      <td>043965548X</td>
      <td>9780439655484</td>
      <td>eng</td>
      <td>435</td>
      <td>2339585</td>
      <td>36325</td>
      <td>5/1/2004</td>
      <td>Scholastic Inc.</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Harry Potter Boxed Set  Books 1-5 (Harry Potte...</td>
      <td>J.K. Rowling/Mary GrandPré</td>
      <td>4.78</td>
      <td>0439682584</td>
      <td>9780439682589</td>
      <td>eng</td>
      <td>2690</td>
      <td>41428</td>
      <td>164</td>
      <td>9/13/2004</td>
      <td>Scholastic</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Unauthorized Harry Potter Book Seven News: "Ha...</td>
      <td>W. Frederick Zimmerman</td>
      <td>3.74</td>
      <td>0976540606</td>
      <td>9780976540601</td>
      <td>en-US</td>
      <td>152</td>
      <td>19</td>
      <td>1</td>
      <td>4/26/2005</td>
      <td>Nimble Books</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Harry Potter Collection (Harry Potter  #1-6)</td>
      <td>J.K. Rowling</td>
      <td>4.73</td>
      <td>0439827604</td>
      <td>9780439827607</td>
      <td>eng</td>
      <td>3342</td>
      <td>28242</td>
      <td>808</td>
      <td>9/12/2005</td>
      <td>Scholastic</td>
    </tr>
    <tr>
      <th>12</th>
      <td>The Ultimate Hitchhiker's Guide: Five Complete...</td>
      <td>Douglas Adams</td>
      <td>4.38</td>
      <td>0517226952</td>
      <td>9780517226957</td>
      <td>eng</td>
      <td>815</td>
      <td>3628</td>
      <td>254</td>
      <td>11/1/2005</td>
      <td>Gramercy Books</td>
    </tr>
    <tr>
      <th>13</th>
      <td>The Ultimate Hitchhiker's Guide to the Galaxy ...</td>
      <td>Douglas Adams</td>
      <td>4.38</td>
      <td>0345453743</td>
      <td>9780345453747</td>
      <td>eng</td>
      <td>815</td>
      <td>249558</td>
      <td>4080</td>
      <td>4/30/2002</td>
      <td>Del Rey Books</td>
    </tr>
    <tr>
      <th>14</th>
      <td>The Hitchhiker's Guide to the Galaxy (Hitchhik...</td>
      <td>Douglas Adams</td>
      <td>4.22</td>
      <td>1400052920</td>
      <td>9781400052929</td>
      <td>eng</td>
      <td>215</td>
      <td>4930</td>
      <td>460</td>
      <td>8/3/2004</td>
      <td>Crown</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="96110cb4" class="cell markdown">
<p>We notice that "average_rating", "num_pages", "ratings_count",
"text_reviews_count" are numerical whereas the other variables are
string variables, with the exeption of "isbn" and "isbn13" which are
also numerical, but those we will talk about later.</p>
<p>Something also worth noticing is that "language_code" seems to be
limited to a definite set of codes, while the other string variables are
free text or indefinite set of strings.</p>
<p>We will now look closer at the numerical values as they can easily be
analysed.</p>
</div>
<div id="981218a6" class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df[[<span class="st">&quot;average_rating&quot;</span>, <span class="st">&quot;num_pages&quot;</span>, <span class="st">&quot;ratings_count&quot;</span>, <span class="st">&quot;text_reviews_count&quot;</span>]]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> df_corr.corr()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/232793762a2796d645c0cb7657d2a3d6f867a1b8.png" /></p>
</div>
</div>
<div id="4d2242be" class="cell markdown">
<p>We see that the numerical variables are generally little correlated
with the respnse variable "average_rating". This immediately tell us
that some additional data processing will have to be done for us to
create a good model.</p>
</div>
<div id="4f00de17" class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pd.plotting.scatter_matrix(df_corr, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>), marker<span class="op">=</span><span class="st">&quot;o&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/ae7ca66387004cf719d64b1fe90b1e09ebff79af.png" /></p>
</div>
</div>
<div id="dc30c30a" class="cell markdown">
<p>From the correlation scatter plot, we can to some degree understand
the cause of the low and high correlations that we found in our previous
plot.</p>
<p>Here we see that there is an exponential-like curve for the
bottom-left plot. This could indicated that a log function of
text_reviews_count could create stronger correlation with average_rating
as there would be a straigher line in the convex part of the plot. <br>
On the other hand, if we look carefully, we see that at some point, the
text reviews go down for some of the books with the very highest ratings
that are close to 5.0. <br> This means that taking some log function of
text reviews will not be optimal, but will still help for the
majority.</p>
<p>We also see that the same case goes for ratings_count.</p>
<p>num_pages has a more linear correlation, but it is spreading out more
for higher rated books, meaning that it is difficult to determine a
function that will transforme these values into something with a higher
correlation to average_rating.</p>
</div>
<div id="90c73f9e" class="cell markdown">
<p>We will now analyse each numerical variable separately.</p>
</div>
<div id="d162ad45" class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.boxplot(df_corr[<span class="st">&quot;average_rating&quot;</span>])</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/9e30779b31a61b3c6ff600676c8efa80177aff5e.png" /></p>
</div>
</div>
<div id="33389a47" class="cell markdown">
<p>We see that the average_rating seems to be quite normally distributed
with a mean just below 4. <br> The reason for a larger spread of values
at the lower end could be because of the limitation of ratings, being
limited from 1 to 5, there is more space between 1 and the mean than
there is between 5 and the mean.</p>
</div>
<div id="a54ed828" class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plt.boxplot(df_corr[<span class="st">&quot;num_pages&quot;</span>])</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/7320bebeebb5fc338870436ca8688d75ef95d141.png" /></p>
</div>
</div>
<div id="9cbc370a" class="cell code" data-execution_count="17">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.boxplot(df_corr[<span class="st">&quot;ratings_count&quot;</span>])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/9a526c0d847dc758f06939916250b4c002563eb0.png" /></p>
</div>
</div>
<div id="3faa418c" class="cell code" data-execution_count="18">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>plt.boxplot(df_corr[<span class="st">&quot;text_reviews_count&quot;</span>])</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/d74ead0dcaed832f4bf8ba582c6dd6450eff118b.png" /></p>
</div>
</div>
<div id="1ac1cacc" class="cell markdown">
<p>Looking at the other variables, there seems to be a poitive skewness
to them.</p>
<p>For the num_pages, one can assume that when an author writes a very
long book, adding another 100 pages is a relatively small part to add if
he/she wants to add some more elements to the book. But if the book is
already very short, adding another 100 pages means that there will be a
very large proportional increase of its number of pages.</p>
<p>When it comes to the rating and review count, there is a simple
explantation one can assume for this skewness. <br> When a book becomes
a topic of conversation there are bound to be many people who read it
and review it. With so many reviews, if the reviews are good (which they
probably are due to the shape of the correlation curve) more people will
read and review them. When there are now even more reviews available,
even more people will discover these reviews and get the urge to read
the book to find out why so many people are reviewing the book. <br> For
a book with few reviews however, there are not many reviews of that
particular book one will randomly stumble upon when browsing reviews at
goodreads.com. This means that fewer people will read it than those
whith many reviews, and thus it will continue to have few reivews.</p>
</div>
<div id="434249db" class="cell code" data-execution_count="28">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plt.hist(df_corr[<span class="st">&quot;text_reviews_count&quot;</span>], bins<span class="op">=</span><span class="dv">30</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels and title</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;num_pages&#39;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Histogram&#39;</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the histogram</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/ed7430de7c43ac634f47bf6d4ca7149ef5681ce8.png" /></p>
</div>
</div>
<div id="c3c6c633" class="cell markdown">
<p>Although a bit difficult to see from this plot, we can see that most
of the books are between 0 and a couple of hundred pages, and then there
some around 500 and getting close to 1000, and then there are a couple
that are 2000 and more, that increase the mean value <br> Even though
those books with the most pages are not the most representative for this
dataset, we have chosen to keep them to as there are books of this kind
of size. <br> How this decision affects our final model will also depend
on what kind of model is being used.</p>
</div>
<div id="8e5eedba" class="cell markdown">
<p>By definition, isbn numbers not correlated to any information about
the book with the possible exception of date published, although this
also has somehting to do with the edition of the book. As we already
have the date published for each book, there is no need for the isbn
numbers, hence we remove them from our dataframe.</p>
</div>
<div id="3a30375b" class="cell code" data-execution_count="4">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">&#39;isbn&#39;</span>, <span class="st">&#39;isbn13&#39;</span>])</span></code></pre></div>
</div>
<div id="8db3dc46" class="cell markdown">
<p>For futher analysis of the publication date, we convert all the
publication date values into the pandas datetime format. Those books not
capable of this process will be removed from the dataframe as there is a
relatively large chance that the reason is miss-reading of data, meaning
that this value is not a date.</p>
</div>
<div id="2079dd17" class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;publication_date&quot;</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">&quot;publication_date&quot;</span>], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna()<span class="op">;</span></span></code></pre></div>
</div>
<div id="94248eb9" class="cell markdown">
<p>As we have seen from the descriptive data, there are many books of
many languages, but there are not many books for each language. <br> To
get some information from the language code, we therefore decide to
create a categorical variable telling if the book is in some kind of
English or not. <br> This will make sure that for each of the two
categories, there is a sufficient number of books.</p>
<p>After creating this variable, we remove the language code variable
from the dataframe.</p>
</div>
<div id="076186b8" class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Categorical variable. 1 if English, 0 if not English</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;is_eng&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;language_code&quot;</span>].<span class="bu">str</span>.contains(<span class="st">&#39;eng|en-&#39;</span>).astype(<span class="bu">int</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">&quot;language_code&quot;</span>])<span class="op">;</span></span></code></pre></div>
</div>
<div id="9d57a01a" class="cell markdown">
<p>As audiobooks are always published after the paper or e-book format
of a book, one can assume that for each audiobook, there is a text based
version.</p>
<p>We therefore created a filter to filter out and remove what we assume
to be audiobooks. <br> These are books with less than 30 pages, or books
published by a publisher with "Audio" in its name.</p>
</div>
<div id="ad18940c" class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove audiobooks</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_audio(row):</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">&#39;num_pages&#39;</span>] <span class="op">&lt;</span> <span class="dv">30</span> <span class="kw">or</span> <span class="st">&quot;audio&quot;</span> <span class="kw">in</span> row[<span class="st">&quot;publisher&quot;</span>]:</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;audio&quot;</span>] <span class="op">=</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> row: is_audio(row), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.audio <span class="op">==</span> <span class="dv">0</span>]</span></code></pre></div>
</div>
<div id="7198af0b" class="cell markdown">
<p>We now create some additional variables based on the ones we already
have.</p>
<p>First we find how long it is since the book was published, based on
the assumed date of extraction and the publication_date.</p>
<p>From that, we are able to find the average frequency of ratings and
reviews.</p>
<p>We can also find the average rating_count and text_reviews_count per
page of each book.</p>
<p>We do also find different combinations og log values of the generated
variables we just mentioned.</p>
</div>
<div id="b059a20b" class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>specific_date_str <span class="op">=</span> <span class="st">&quot;2022-12-31&quot;</span> <span class="co">#yyyy-mm-dd</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>specific_date <span class="op">=</span> pd.to_datetime(specific_date_str)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Find time since the books were published</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;days_since_published&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;publication_date&quot;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: (specific_date <span class="op">-</span> x).days)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;years_since_published&quot;</span>] <span class="op">=</span> df.days_since_published <span class="op">/</span> <span class="fl">365.24</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_days_since_published&quot;</span>] <span class="op">=</span> np.clip(np.log(df.days_since_published), <span class="dv">0</span>, np.inf)</span></code></pre></div>
</div>
<div id="6a48e9b7" class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_num_pages&quot;</span>] <span class="op">=</span> np.log(df.num_pages)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_r_count&quot;</span>] <span class="op">=</span> np.log(df.ratings_count)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_t_count&quot;</span>] <span class="op">=</span> np.clip(np.log(df.text_reviews_count), <span class="dv">0</span>, np.inf)</span></code></pre></div>
</div>
<div id="1a244cd2" class="cell code" data-execution_count="10">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create variable that is rating/text_review per day/year/log_day (rating/review density)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;r_count_per_day&quot;</span>] <span class="op">=</span> df.ratings_count <span class="op">/</span> df.days_since_published</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;t_count_per_day&quot;</span>] <span class="op">=</span> df.text_reviews_count <span class="op">/</span> df.days_since_published</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;r_count_per_year&quot;</span>] <span class="op">=</span> df.ratings_count <span class="op">/</span> df.years_since_published</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;t_count_per_year&quot;</span>] <span class="op">=</span> df.text_reviews_count <span class="op">/</span> df.years_since_published</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;r_count_per_log_day&quot;</span>] <span class="op">=</span> df.ratings_count <span class="op">/</span> df.log_days_since_published</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;t_count_per_log_day&quot;</span>] <span class="op">=</span> df.text_reviews_count <span class="op">/</span> df.log_days_since_published</span></code></pre></div>
</div>
<div id="edbdb2a6" class="cell code" data-execution_count="11">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_r_count_per_day&quot;</span>] <span class="op">=</span> df.log_r_count <span class="op">/</span> df.days_since_published</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_t_count_per_day&quot;</span>] <span class="op">=</span> df.log_t_count <span class="op">/</span> df.days_since_published</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_r_count_per_year&quot;</span>] <span class="op">=</span> df.log_r_count <span class="op">/</span> df.years_since_published</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_t_count_per_year&quot;</span>] <span class="op">=</span> df.log_t_count <span class="op">/</span> df.years_since_published</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_r_count_per_log_day&quot;</span>] <span class="op">=</span> df.log_r_count <span class="op">/</span> df.log_days_since_published</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_t_count_per_log_day&quot;</span>] <span class="op">=</span> df.log_t_count <span class="op">/</span> df.log_days_since_published</span></code></pre></div>
</div>
<div id="c59f2deb" class="cell code" data-execution_count="12">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;ratings_count_per_num_pages&quot;</span>] <span class="op">=</span> df.ratings_count <span class="op">/</span> df.num_pages</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;text_reviews_count_per_num_pages&quot;</span>] <span class="op">=</span> df.text_reviews_count <span class="op">/</span> df.num_pages</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;ratings_count_per_log_num_pages&quot;</span>] <span class="op">=</span> df.ratings_count <span class="op">/</span> df.log_num_pages</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;text_reviews_count_per_log_num_pages&quot;</span>] <span class="op">=</span> df.text_reviews_count <span class="op">/</span> df.log_num_pages</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_r_count_per_num_pages&quot;</span>] <span class="op">=</span> df.log_r_count <span class="op">/</span> df.num_pages</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_t_count_per_num_pages&quot;</span>] <span class="op">=</span> df.log_t_count <span class="op">/</span> df.num_pages</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_r_count_per_log_num_pages&quot;</span>] <span class="op">=</span> df.log_r_count <span class="op">/</span> df.log_num_pages</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;log_t_count_per_log_num_pages&quot;</span>] <span class="op">=</span> df.log_t_count <span class="op">/</span> df.log_num_pages</span></code></pre></div>
</div>
<div id="a1a558da" class="cell markdown">
<p>As of the scale of this model, and as we do not wish to create a NLP
based model, we now remove the remaining sting-based variables from the
dataframe before doing further analysis.</p>
</div>
<div id="a4a72eb7" class="cell code" data-execution_count="13">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">&#39;title&#39;</span>, <span class="st">&#39;authors&#39;</span>, <span class="st">&#39;language_code&#39;</span>, <span class="st">&#39;publication_date&#39;</span>, <span class="st">&#39;publisher&#39;</span>, <span class="st">&#39;audio&#39;</span>])</span></code></pre></div>
</div>
<div id="b713514f" class="cell markdown">
<p>We now do a check to see if all our remaining values are numeric, and
if there are some books with non-numeric values in the dataframe as of
now, these books will be removed from the dataframe.</p>
</div>
<div id="2c2458f2" class="cell code" data-execution_count="14">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>).dropna()</span></code></pre></div>
</div>
<div id="7e555768" class="cell markdown">
<p>All values in the dataframe should now be numerical.</p>
<p>We create a correlation plot to get an understanding of our newly
added variables.</p>
</div>
<div id="2bd3dd0e" class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> df.corr()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, annot<span class="op">=</span><span class="va">False</span>, cmap<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/10c3b557f613a5ed032e060a16d088ec55d3efdb.png" /></p>
</div>
</div>
<div id="a9933f0a" class="cell markdown">
<p>We split the correlation plot into 3 equally sized parts to have a
closer look.</p>
<p>All the correlation plots contains average_rating.</p>
</div>
<div id="86fafcc8" class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>c1 <span class="op">=</span> df.iloc[:, <span class="dv">0</span>:<span class="dv">11</span>]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> c1.corr()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/b1ca73cb3f372bf099a8e87bd296da4212d0ff05.png" /></p>
</div>
</div>
<div id="3f343500" class="cell code" data-execution_count="17">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>c2 <span class="op">=</span> pd.concat([df.iloc[:, <span class="dv">0</span>], df.iloc[:, <span class="dv">11</span>:<span class="dv">21</span>]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> c2.corr()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/68ececdb73aad39bc2ff19d3b63011fb9727a170.png" /></p>
</div>
</div>
<div id="ae050f2e" class="cell code" data-execution_count="18">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>c3 <span class="op">=</span> pd.concat([df.iloc[:, <span class="dv">0</span>], df.iloc[:, <span class="dv">21</span>:df.shape[<span class="dv">1</span>]]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> c3.corr()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/d100e6b57e9aba2bd053e482065b5937c4378ff1.png" /></p>
</div>
</div>
<div id="69d718f7" class="cell markdown">
<p>As we can see, there are now many highly correlated variables,
although still none of them are highly correlated with the response
variable. Even though, we can see that we have created some variables
that are more correlated with the response variable than some of those
we had initially. <br> We can for example see that log_num_pages and
log_r_count_per_log_day, some of our new variables has a higher
correlation than some of the old ones.</p>
</div>
<div id="46ffb4db" class="cell markdown">
<p>We will now find out what model is the best and the most stable by
running it through a a series of random distributions of training- and
test data.</p>
<p>The <span class="math inline"><em>R</em><sup>2</sup></span> scores
for each model will be stored in a list that will be analysed
afterwards.</p>
<p>After finding the model with the best <span
class="math inline"><em>R</em><sup>2</sup></span>, we will take a closer
look at that model and see if there are some insignificant explanatory
variables that can be removed.</p>
<p>We can already assume that this will be the case, as we can see from
the correlation plot that some of the variables we created by
transforming other variables are highly correlated with each other, but
not that correlated with the response variable.</p>
<p>We start by defining our models:</p>
</div>
<div id="81902c20" class="cell code" data-execution_count="19">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> linmod(X_train, X_test, y_train, y_test):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Linear regression model</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a linear regression model and limit predicted values to between 0 and 5</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LinearRegression()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict the target values for the test data</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.clip(model.predict(X_test), <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the R^2 value</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2, mse</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> polmod(X_train, X_test, y_train, y_test):</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Polynomial regression model</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a polynomial regression model and limit predicted values to between 0 and 5</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    poly <span class="op">=</span> PolynomialFeatures(degree<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> poly.fit_transform(X_train)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> poly.transform(X_test)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LinearRegression()</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict the target values for the test data</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.clip(model.predict(X_test), <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the R^2 value for the test data</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2, mse</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> svrmod(X_train, X_test, y_train, y_test):</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit SVR model</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> SVR(kernel<span class="op">=</span><span class="st">&#39;rbf&#39;</span>)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict the target values for the test data</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.clip(model.predict(X_test), <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get R^2 value</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2, mse</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rafmod(X_train, X_test, y_train, y_test):</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit random forest regression model</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict on test data and limit predicted values to between 1 and 5</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.clip(model.predict(X_test), <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get R^2 value</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2, mse</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ridmod(X_train, X_test, y_train, y_test):</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Instantiate the Ridge model</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Ridge(alpha<span class="op">=</span><span class="fl">0.000001</span>)</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the Ridge model to the training data</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the Ridge model to make predictions on the test data</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.clip(model.predict(X_test), <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get R^2 value</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2, mse</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lasmod(X_train, X_test, y_train, y_test):</span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Instantiate the Lasso model</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Lasso(alpha<span class="op">=</span><span class="fl">0.000001</span>)</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the Lasso model to the training data</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the Lasso model to make predictions on the test data</span></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.clip(model.predict(X_test), <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get R^2 value</span></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2, mse</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> baymod(X_train, X_test, y_train, y_test):</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create and fit the Bayesian Ridge model</span></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> BayesianRidge()</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the bayesian ridge model to make predictions on the test data</span></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.clip(model.predict(X_test), <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get R^2 value</span></span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2, mse</span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lgbmod(X_train, X_test, y_train, y_test):</span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the LightGBM model</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LGBMRegressor(learning_rate<span class="op">=</span><span class="fl">0.07</span>, n_estimators<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the LightGBM model to make predictions on the test data</span></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.clip(model.predict(X_test), <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get R^2 value</span></span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2, mse</span></code></pre></div>
</div>
<div id="5de53655" class="cell code" data-execution_count="20">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.iloc[:, <span class="dv">1</span>:df.shape[<span class="dv">1</span>]]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">&#39;average_rating&#39;</span>]</span></code></pre></div>
</div>
<div id="c6afa78f" class="cell code" data-execution_count="21">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(linmod(X_train, X_test, y_train, y_test))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(polmod(X_train, X_test, y_train, y_test))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(svrmod(X_train, X_test, y_train, y_test))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rafmod(X_train, X_test, y_train, y_test))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ridmod(X_train, X_test, y_train, y_test))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lasmod(X_train, X_test, y_train, y_test))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(baymod(X_train, X_test, y_train, y_test))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lgbmod(X_train, X_test, y_train, y_test))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(0.0931906469758923, 0.07561791589101592)
(0.05932547842801328, 0.078441898085673)
(0.013684871921737507, 0.08224782215614823)
(0.07056899822793872, 0.07750431232774675)
(0.09319017076125324, 0.0756179556020736)
(0.09183575538949651, 0.0757308989316957)
(0.08508034328949188, 0.0762942259224063)
(0.10211357472120908, 0.07487384196026431)
</code></pre>
</div>
</div>
<div id="d227bf5d" class="cell markdown">
<p>We can see that polynominal model, svr model and the random forest
model are not inferior to the other models. <br> Hence we will discard
those and focus on the remaining models.</p>
</div>
<div id="1ebeef31" class="cell code" data-execution_count="22">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>linmod_rsq_list <span class="op">=</span> []</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#polmod_rsq_list = []</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#svrmod_rsq_list = []</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#rafmod_rsq_list = []</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>ridmod_rsq_list <span class="op">=</span> []</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>lasmod_rsq_list <span class="op">=</span> []</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>baymod_rsq_list <span class="op">=</span> []</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>lgbmod_rsq_list <span class="op">=</span> []</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>linmod_mse_list <span class="op">=</span> []</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">#polmod_mse_list = []</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">#svrmod_mse_list = []</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">#rafmod_mse_list = []</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>ridmod_mse_list <span class="op">=</span> []</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>lasmod_mse_list <span class="op">=</span> []</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>baymod_mse_list <span class="op">=</span> []</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>lgbmod_mse_list <span class="op">=</span> []</span></code></pre></div>
</div>
<div id="dc94e57a" class="cell code" data-execution_count="23">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> linmod(X_train, X_test, y_train, y_test)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    linmod_rsq_list.append(rsq)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    linmod_mse_list.append(mse)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#rsq, mse = polmod(X_train, X_test, y_train, y_test)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#polmod_rsq_list.append(rsq)</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#polmod_mse_list.append(mse)</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#rsq, mse = svrmod(X_train, X_test, y_train, y_test)</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#svrmod_rsq_list.append(rsq)</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#svrmod_mse_list.append(mse)</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#rsq, mse = rafmod(X_train, X_test, y_train, y_test)</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#rafmod_rsq_list.append(rsq)</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#rafmod_mse_list.append(mse)</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> ridmod(X_train, X_test, y_train, y_test)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    ridmod_rsq_list.append(rsq)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    ridmod_mse_list.append(mse)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lasmod(X_train, X_test, y_train, y_test)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    lasmod_rsq_list.append(rsq)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    lasmod_mse_list.append(mse)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> baymod(X_train, X_test, y_train, y_test)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    baymod_rsq_list.append(rsq)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    baymod_mse_list.append(mse)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    lgbmod_rsq_list.append(rsq)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    lgbmod_mse_list.append(mse)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>   </span></code></pre></div>
</div>
<div id="b435f41e" class="cell code" data-execution_count="24">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(linmod_rsq_list))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print(np.mean(polmod_rsq_list))</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#print(np.mean(svrmod_rsq_list))</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#print(np.mean(rafmod_rsq_list))</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(ridmod_rsq_list))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(lasmod_rsq_list))</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(baymod_rsq_list))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(lgbmod_rsq_list))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>0.08878034145153019
0.08878075035748252
0.08972693819817139
0.08429784128852393
0.09926534061732838
</code></pre>
</div>
</div>
<div id="5fd0ebc6" class="cell code" data-execution_count="25">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(linmod_mse_list))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print(np.mean(polmod_mse_list))</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#print(np.mean(svrmod_mse_list))</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#print(np.mean(rafmod_mse_list))</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(ridmod_mse_list))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(lasmod_mse_list))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(baymod_mse_list))</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(lgbmod_mse_list))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>0.07997637127941223
0.07997633477892595
0.07989276222436086
0.0803714003220104
0.07909268542508259
</code></pre>
</div>
</div>
<div id="4ec0293c" class="cell markdown">
<p>We see that the lgbmod, which is the LightGBM model has the highest
<span class="math inline"><em>R</em><sup>2</sup></span> value.</p>
<p>We will now look closer at that model, we look at it for the latest
random_state distribution seed for the training data and test data
distribution. This can be done as we don't know how this seed compares
with the other ones for this model, so our analysis of the model in this
case is unbiased.</p>
</div>
<div id="d36deed9" class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>P-values sorted from largest to smallest:
log_t_count_per_day                     9.977301e-01
log_t_count_per_year                    9.977301e-01
log_num_pages                           9.601149e-01
years_since_published                   6.970422e-01
days_since_published                    6.968258e-01
ratings_count_per_num_pages             6.874249e-01
log_r_count_per_log_num_pages           6.272965e-01
ratings_count                           6.183681e-01
log_r_count_per_num_pages               6.117183e-01
ratings_count_per_log_num_pages         5.774944e-01
log_r_count_per_year                    5.087158e-01
log_r_count_per_day                     5.087158e-01
r_count_per_log_day                     4.917627e-01
log_t_count_per_num_pages               4.721478e-01
text_reviews_count_per_num_pages        4.560397e-01
text_reviews_count_per_log_num_pages    3.948316e-01
t_count_per_day                         3.778037e-01
t_count_per_year                        3.778037e-01
log_t_count_per_log_num_pages           2.896444e-01
r_count_per_day                         2.327815e-01
r_count_per_year                        2.327800e-01
t_count_per_log_day                     2.166081e-01
text_reviews_count                      1.437016e-01
log_r_count_per_log_day                 5.604582e-02
log_r_count                             4.530686e-02
log_t_count_per_log_day                 2.615717e-02
log_t_count                             1.397402e-02
log_days_since_published                5.851059e-03
const                                   1.526743e-04
is_eng                                  2.478907e-08
num_pages                               3.633980e-18
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="c3ffbc8e" class="cell markdown">
<p>We see that ratings_count_per_num_pages has the highest p-value,
meaning it is the least significant variable for our model. We will nor
try to simplify the model until all variables have a significance level
of <strong>90%</strong></p>
<p>As the variables are correlated with each other to some degree, we
can only remove one at a time as the p-values will potentially change
for the other variables when one variable is removed.</p>
</div>
<div id="2229a905" class="cell code" data-execution_count="27">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;ratings_count_per_num_pages&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.07779959317766916
MSE : 0.08091509270910256
P-values sorted from largest to smallest:
log_t_count_per_day                     9.966971e-01
log_t_count_per_year                    9.966971e-01
log_num_pages                           9.474375e-01
years_since_published                   7.038834e-01
days_since_published                    7.033574e-01
log_r_count_per_log_num_pages           6.441218e-01
ratings_count                           5.868261e-01
log_r_count_per_num_pages               5.707548e-01
r_count_per_log_day                     5.146427e-01
log_t_count_per_num_pages               5.103270e-01
log_r_count_per_day                     5.098185e-01
log_r_count_per_year                    5.098185e-01
ratings_count_per_log_num_pages         5.065674e-01
t_count_per_year                        3.704797e-01
t_count_per_day                         3.704797e-01
text_reviews_count_per_num_pages        3.122713e-01
log_t_count_per_log_num_pages           3.040270e-01
r_count_per_year                        2.447463e-01
r_count_per_day                         2.447444e-01
text_reviews_count_per_log_num_pages    2.129224e-01
t_count_per_log_day                     2.036736e-01
text_reviews_count                      1.577687e-01
log_r_count_per_log_day                 5.612768e-02
log_r_count                             4.586784e-02
log_t_count_per_log_day                 2.615186e-02
log_t_count                             1.419939e-02
log_days_since_published                6.074531e-03
const                                   1.447302e-04
is_eng                                  2.488038e-08
num_pages                               3.925467e-18
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="b9ab6452" class="cell markdown">
<p>We continue the procedure of removing the variable with the highest
p-value and then re-calculating the p-values</p>
</div>
<div id="88f65091" class="cell code" data-execution_count="28">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;log_r_count_per_log_num_pages&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.07659357975338554
MSE : 0.08102090993420072
P-values sorted from largest to smallest:
log_t_count_per_year                    9.911709e-01
log_t_count_per_day                     9.911709e-01
log_num_pages                           9.368131e-01
days_since_published                    7.043394e-01
years_since_published                   6.659871e-01
log_t_count_per_num_pages               6.120292e-01
ratings_count                           5.826213e-01
ratings_count_per_log_num_pages         5.288175e-01
r_count_per_log_day                     5.123060e-01
log_r_count_per_year                    5.055634e-01
log_r_count_per_day                     5.055634e-01
t_count_per_year                        3.740854e-01
t_count_per_day                         3.740847e-01
text_reviews_count_per_num_pages        3.360341e-01
r_count_per_year                        2.436049e-01
r_count_per_day                         2.435294e-01
text_reviews_count_per_log_num_pages    2.381682e-01
t_count_per_log_day                     2.066626e-01
text_reviews_count                      1.631233e-01
log_r_count_per_log_day                 5.575653e-02
log_r_count                             5.202371e-02
log_t_count_per_log_num_pages           4.294451e-02
log_t_count_per_log_day                 2.609006e-02
log_r_count_per_num_pages               2.351490e-02
log_t_count                             1.601504e-02
log_days_since_published                5.947602e-03
const                                   1.310606e-04
is_eng                                  2.464521e-08
num_pages                               1.046651e-18
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="66834794" class="cell code" data-execution_count="29">
<div class="sourceCode" id="cb44"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;log_r_count_per_day&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.07659357975338554
MSE : 0.08102090993420072
P-values sorted from largest to smallest:
log_t_count_per_year                    9.911709e-01
log_t_count_per_day                     9.911709e-01
log_num_pages                           9.368131e-01
days_since_published                    7.043399e-01
log_t_count_per_num_pages               6.120292e-01
years_since_published                   6.034584e-01
ratings_count                           5.826213e-01
ratings_count_per_log_num_pages         5.288175e-01
r_count_per_log_day                     5.123060e-01
log_r_count_per_year                    5.055634e-01
t_count_per_day                         3.740861e-01
t_count_per_year                        3.740854e-01
text_reviews_count_per_num_pages        3.360341e-01
r_count_per_year                        2.436049e-01
r_count_per_day                         2.434958e-01
text_reviews_count_per_log_num_pages    2.381682e-01
t_count_per_log_day                     2.066626e-01
text_reviews_count                      1.631233e-01
log_r_count_per_log_day                 5.575653e-02
log_r_count                             5.202371e-02
log_t_count_per_log_num_pages           4.294451e-02
log_t_count_per_log_day                 2.609006e-02
log_r_count_per_num_pages               2.351490e-02
log_t_count                             1.601504e-02
log_days_since_published                5.947602e-03
const                                   1.310606e-04
is_eng                                  2.464521e-08
num_pages                               1.046651e-18
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="83848a68" class="cell code" data-execution_count="30">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;years_since_published&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.07659357975338554
MSE : 0.08102090993420072
P-values sorted from largest to smallest:
log_t_count_per_day                     9.911709e-01
log_t_count_per_year                    9.911709e-01
log_num_pages                           9.368131e-01
days_since_published                    7.043391e-01
log_t_count_per_num_pages               6.120292e-01
ratings_count                           5.826213e-01
ratings_count_per_log_num_pages         5.288175e-01
r_count_per_log_day                     5.123060e-01
log_r_count_per_year                    5.055634e-01
t_count_per_year                        3.740854e-01
t_count_per_day                         3.740854e-01
text_reviews_count_per_num_pages        3.360341e-01
r_count_per_day                         2.436278e-01
r_count_per_year                        2.436049e-01
text_reviews_count_per_log_num_pages    2.381682e-01
t_count_per_log_day                     2.066626e-01
text_reviews_count                      1.631233e-01
log_r_count_per_log_day                 5.575653e-02
log_r_count                             5.202371e-02
log_t_count_per_log_num_pages           4.294451e-02
log_t_count_per_log_day                 2.609006e-02
log_r_count_per_num_pages               2.351490e-02
log_t_count                             1.601504e-02
log_days_since_published                5.947602e-03
const                                   1.310606e-04
is_eng                                  2.464521e-08
num_pages                               1.046651e-18
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="f1c0eb87" class="cell code" data-execution_count="31">
<div class="sourceCode" id="cb48"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;log_r_count_per_year&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.07895873907385831
MSE : 0.08081338770337966
P-values sorted from largest to smallest:
days_since_published                    9.977411e-01
log_num_pages                           9.249998e-01
ratings_count                           6.295167e-01
log_t_count_per_num_pages               6.096851e-01
r_count_per_log_day                     5.566952e-01
ratings_count_per_log_num_pages         5.186550e-01
text_reviews_count_per_num_pages        3.375571e-01
r_count_per_day                         2.741526e-01
r_count_per_year                        2.739919e-01
text_reviews_count_per_log_num_pages    2.337038e-01
t_count_per_year                        2.314393e-01
t_count_per_day                         2.314381e-01
t_count_per_log_day                     1.283452e-01
text_reviews_count                      1.001875e-01
log_t_count_per_log_num_pages           4.087565e-02
log_r_count_per_num_pages               2.345238e-02
log_days_since_published                5.877405e-03
log_t_count_per_year                    4.529444e-03
log_t_count_per_day                     4.529444e-03
const                                   4.206176e-06
log_r_count                             3.939012e-08
is_eng                                  2.411872e-08
log_r_count_per_log_day                 1.470090e-09
log_t_count                             2.868636e-12
log_t_count_per_log_day                 7.272227e-13
num_pages                               1.006651e-18
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="8f5bb32c" class="cell code" data-execution_count="32">
<div class="sourceCode" id="cb50"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;days_since_published&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.07895651122107272
MSE : 0.08081358317815213
P-values sorted from largest to smallest:
log_num_pages                           9.249629e-01
ratings_count                           6.293245e-01
log_t_count_per_num_pages               6.096559e-01
r_count_per_log_day                     5.565082e-01
ratings_count_per_log_num_pages         5.183142e-01
text_reviews_count_per_num_pages        3.375115e-01
r_count_per_year                        2.739247e-01
r_count_per_day                         2.739229e-01
text_reviews_count_per_log_num_pages    2.336652e-01
t_count_per_year                        2.180160e-01
t_count_per_day                         2.180159e-01
t_count_per_log_day                     1.192881e-01
text_reviews_count                      9.268883e-02
log_t_count_per_log_num_pages           4.084757e-02
log_r_count_per_num_pages               2.343159e-02
log_t_count_per_day                     1.075940e-03
log_t_count_per_year                    1.075940e-03
log_days_since_published                4.306682e-06
log_r_count                             3.326343e-08
is_eng                                  2.402976e-08
log_r_count_per_log_day                 1.200155e-09
const                                   1.597510e-12
log_t_count                             4.138238e-13
log_t_count_per_log_day                 5.786400e-14
num_pages                               9.999475e-19
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="db13803c" class="cell code" data-execution_count="33">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;text_reviews_count_per_num_pages&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.08117185489430057
MSE : 0.08061920597187934
P-values sorted from largest to smallest:
log_num_pages                           8.921082e-01
log_t_count_per_num_pages               7.499376e-01
ratings_count                           6.602837e-01
r_count_per_log_day                     5.675805e-01
text_reviews_count_per_log_num_pages    4.800320e-01
r_count_per_day                         2.668981e-01
r_count_per_year                        2.668907e-01
ratings_count_per_log_num_pages         2.660318e-01
t_count_per_day                         2.098658e-01
t_count_per_year                        2.098658e-01
t_count_per_log_day                     1.060692e-01
text_reviews_count                      9.822319e-02
log_t_count_per_log_num_pages           5.574631e-02
log_r_count_per_num_pages               1.954521e-02
log_t_count_per_day                     1.023968e-03
log_t_count_per_year                    1.023968e-03
log_days_since_published                4.155557e-06
log_r_count                             3.049899e-08
is_eng                                  2.489302e-08
log_r_count_per_log_day                 1.104218e-09
const                                   1.544955e-12
log_t_count                             4.156707e-13
log_t_count_per_log_day                 4.918421e-14
num_pages                               6.601650e-19
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="04369d2c" class="cell code" data-execution_count="34">
<div class="sourceCode" id="cb54"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;t_count_per_day&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.08117185489430057
MSE : 0.08061920597187934
P-values sorted from largest to smallest:
log_num_pages                           8.921082e-01
log_t_count_per_num_pages               7.499376e-01
ratings_count                           6.602837e-01
r_count_per_log_day                     5.675805e-01
text_reviews_count_per_log_num_pages    4.800320e-01
r_count_per_day                         2.668951e-01
r_count_per_year                        2.668907e-01
ratings_count_per_log_num_pages         2.660318e-01
t_count_per_year                        2.098658e-01
t_count_per_log_day                     1.060692e-01
text_reviews_count                      9.822319e-02
log_t_count_per_log_num_pages           5.574631e-02
log_r_count_per_num_pages               1.954521e-02
log_t_count_per_year                    1.023968e-03
log_t_count_per_day                     1.023968e-03
log_days_since_published                4.155557e-06
log_r_count                             3.049899e-08
is_eng                                  2.489302e-08
log_r_count_per_log_day                 1.104218e-09
const                                   1.544955e-12
log_t_count                             4.156707e-13
log_t_count_per_log_day                 4.918421e-14
num_pages                               6.601650e-19
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="ac3c7b9a" class="cell code" data-execution_count="35">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;t_count_per_year&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.08326825319036435
MSE : 0.08043526519151717
P-values sorted from largest to smallest:
log_num_pages                           8.977374e-01
log_t_count_per_num_pages               7.557874e-01
text_reviews_count_per_log_num_pages    5.957391e-01
ratings_count_per_log_num_pages         3.254730e-01
text_reviews_count                      1.908493e-01
t_count_per_log_day                     1.819478e-01
ratings_count                           1.081239e-01
r_count_per_log_day                     7.851864e-02
log_t_count_per_log_num_pages           6.199572e-02
r_count_per_day                         2.096573e-02
r_count_per_year                        2.096547e-02
log_r_count_per_num_pages               2.002320e-02
log_t_count_per_day                     2.161898e-03
log_t_count_per_year                    2.161898e-03
log_days_since_published                3.188722e-06
is_eng                                  2.506309e-08
log_r_count                             2.112226e-08
log_r_count_per_log_day                 7.287383e-10
const                                   2.147245e-12
log_t_count                             9.218628e-13
log_t_count_per_log_day                 1.055863e-13
num_pages                               6.023291e-19
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="62525877" class="cell code" data-execution_count="36">
<div class="sourceCode" id="cb58"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;text_reviews_count_per_log_num_pages&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.08468894159067641
MSE : 0.0803106120979254
P-values sorted from largest to smallest:
log_num_pages                      9.063994e-01
log_t_count_per_num_pages          7.699576e-01
ratings_count_per_log_num_pages    2.903899e-01
text_reviews_count                 2.317168e-01
t_count_per_log_day                2.114208e-01
ratings_count                      1.031859e-01
r_count_per_log_day                8.127680e-02
log_t_count_per_log_num_pages      7.265655e-02
r_count_per_day                    2.309392e-02
r_count_per_year                   2.309373e-02
log_r_count_per_num_pages          2.130250e-02
log_t_count_per_day                2.225462e-03
log_t_count_per_year               2.225462e-03
log_days_since_published           3.112713e-06
is_eng                             2.468291e-08
log_r_count                        2.273952e-08
log_r_count_per_log_day            7.875510e-10
const                              2.259779e-12
log_t_count                        1.053424e-12
log_t_count_per_log_day            1.208302e-13
num_pages                          4.267979e-19
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="6d479462" class="cell code" data-execution_count="37">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;log_r_count_per_num_pages&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.0878357115148275
MSE : 0.08003451031108683
P-values sorted from largest to smallest:
ratings_count_per_log_num_pages    3.836645e-01
text_reviews_count                 2.248798e-01
t_count_per_log_day                2.045243e-01
ratings_count                      1.063539e-01
r_count_per_log_day                8.531830e-02
r_count_per_day                    2.461420e-02
r_count_per_year                   2.461398e-02
log_num_pages                      1.893771e-02
log_t_count_per_log_num_pages      2.511438e-03
log_t_count_per_day                2.379593e-03
log_t_count_per_year               2.379593e-03
log_days_since_published           2.731836e-06
log_t_count_per_num_pages          1.611495e-07
log_r_count                        3.052603e-08
is_eng                             2.344832e-08
log_r_count_per_log_day            7.094023e-10
log_t_count                        5.674929e-13
log_t_count_per_log_day            1.181236e-13
const                              3.773386e-14
num_pages                          5.512160e-23
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="f3b5ae0f" class="cell code" data-execution_count="38">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;ratings_count_per_log_num_pages&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.08360539303940417
MSE : 0.08040568409185686
P-values sorted from largest to smallest:
text_reviews_count               2.237945e-01
t_count_per_log_day              2.039148e-01
ratings_count                    1.097182e-01
r_count_per_log_day              9.488925e-02
r_count_per_day                  3.049471e-02
r_count_per_year                 3.049443e-02
log_num_pages                    1.346638e-02
log_t_count_per_day              2.738164e-03
log_t_count_per_year             2.738164e-03
log_t_count_per_log_num_pages    6.928598e-04
log_days_since_published         3.191367e-06
log_t_count_per_num_pages        4.862640e-08
log_r_count                      3.301165e-08
is_eng                           2.310360e-08
log_r_count_per_log_day          7.759321e-10
log_t_count                      4.702690e-13
log_t_count_per_log_day          1.297794e-13
const                            2.065499e-14
num_pages                        6.720865e-23
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="7e7606fb" class="cell code" data-execution_count="39">
<div class="sourceCode" id="cb64"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;text_reviews_count&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.08799445662809935
MSE : 0.08002058180328908
P-values sorted from largest to smallest:
ratings_count                    3.278462e-02
r_count_per_log_day              3.256309e-02
r_count_per_year                 2.854960e-02
r_count_per_day                  2.854948e-02
log_num_pages                    1.388003e-02
t_count_per_log_day              4.680612e-03
log_t_count_per_day              1.104978e-03
log_t_count_per_year             1.104978e-03
log_t_count_per_log_num_pages    6.899456e-04
log_days_since_published         4.689133e-06
log_r_count                      6.716108e-08
log_t_count_per_num_pages        4.611025e-08
is_eng                           2.385574e-08
log_r_count_per_log_day          1.613545e-09
log_t_count                      9.576333e-13
log_t_count_per_log_day          2.586515e-13
const                            8.873690e-15
num_pages                        7.061654e-23
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="05c84e67" class="cell code" data-execution_count="40">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;ratings_count&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.08834960389393653
MSE : 0.07998942070888052
P-values sorted from largest to smallest:
r_count_per_log_day              8.812686e-01
r_count_per_year                 6.170276e-01
r_count_per_day                  6.170104e-01
log_num_pages                    1.384675e-02
log_t_count_per_day              1.311317e-02
log_t_count_per_year             1.311317e-02
t_count_per_log_day              8.293104e-03
log_t_count_per_log_num_pages    7.954289e-04
log_days_since_published         2.570123e-06
log_t_count_per_num_pages        5.676850e-08
log_r_count                      4.633609e-08
is_eng                           2.491804e-08
log_r_count_per_log_day          1.081216e-09
log_t_count                      8.223953e-12
log_t_count_per_log_day          2.467026e-12
const                            1.991861e-14
num_pages                        5.932458e-23
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="17a6579a" class="cell code" data-execution_count="41">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;r_count_per_log_day&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.0894632837348871
MSE : 0.07989170495543678
P-values sorted from largest to smallest:
r_count_per_year                 2.099363e-01
r_count_per_day                  2.099062e-01
log_num_pages                    1.374259e-02
log_t_count_per_day              1.318491e-02
log_t_count_per_year             1.318491e-02
t_count_per_log_day              7.805283e-03
log_t_count_per_log_num_pages    7.998509e-04
log_days_since_published         2.333532e-06
log_t_count_per_num_pages        5.723610e-08
log_r_count                      4.675107e-08
is_eng                           2.468018e-08
log_r_count_per_log_day          1.089575e-09
log_t_count                      7.921331e-12
log_t_count_per_log_day          2.386505e-12
const                            1.067441e-14
num_pages                        5.700371e-23
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="f998420d" class="cell code" data-execution_count="42">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;r_count_per_day&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.0894632837348871
MSE : 0.07989170495543678
P-values sorted from largest to smallest:
r_count_per_year                 2.099363e-01
log_num_pages                    1.374259e-02
log_t_count_per_year             1.318491e-02
log_t_count_per_day              1.318491e-02
t_count_per_log_day              7.805283e-03
log_t_count_per_log_num_pages    7.998509e-04
log_days_since_published         2.333532e-06
log_t_count_per_num_pages        5.723610e-08
log_r_count                      4.675107e-08
is_eng                           2.468018e-08
log_r_count_per_log_day          1.089575e-09
log_t_count                      7.921331e-12
log_t_count_per_log_day          2.386505e-12
const                            1.067441e-14
num_pages                        5.700371e-23
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="3c383656" class="cell code" data-execution_count="43">
<div class="sourceCode" id="cb72"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;r_count_per_year&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.08430097292558125
MSE : 0.08034465298564586
P-values sorted from largest to smallest:
log_t_count_per_day              1.446383e-02
log_t_count_per_year             1.446383e-02
log_num_pages                    1.371101e-02
t_count_per_log_day              1.795164e-03
log_t_count_per_log_num_pages    8.769064e-04
log_days_since_published         3.357148e-06
log_r_count                      7.109747e-08
log_t_count_per_num_pages        6.789585e-08
is_eng                           2.616109e-08
log_r_count_per_log_day          1.764076e-09
log_t_count                      1.261486e-11
log_t_count_per_log_day          3.905608e-12
const                            4.629856e-15
num_pages                        5.241109e-23
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="0cef1281" class="cell code" data-execution_count="44">
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>lgbmod_rsq_list <span class="op">=</span> []</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>lgbmod_mse_list <span class="op">=</span> []</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>):</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    lgbmod_rsq_list.append(rsq)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    lgbmod_mse_list.append(mse)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean R^2 : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_rsq_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean MSE : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_mse_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>mean R^2 : 0.09879827552726421
mean MSE : 0.07913022937364236
</code></pre>
</div>
</div>
<div id="70cb3b49" class="cell code" data-execution_count="45">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;t_count_per_log_day&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.0895027065116476
MSE : 0.07988824594846516
P-values sorted from largest to smallest:
log_t_count_per_year             2.053747e-02
log_t_count_per_day              2.053747e-02
log_num_pages                    7.111774e-03
log_t_count_per_log_num_pages    4.572023e-04
log_days_since_published         1.531265e-06
log_r_count                      8.411044e-08
log_t_count_per_num_pages        5.288123e-08
is_eng                           7.022808e-09
log_r_count_per_log_day          2.121299e-09
log_t_count                      3.129917e-11
log_t_count_per_log_day          1.281013e-11
const                            1.117258e-14
num_pages                        3.601356e-23
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="9c09f463" class="cell code" data-execution_count="46">
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>lgbmod_rsq_list <span class="op">=</span> []</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>lgbmod_mse_list <span class="op">=</span> []</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>):</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    lgbmod_rsq_list.append(rsq)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    lgbmod_mse_list.append(mse)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean R^2 : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_rsq_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean MSE : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_mse_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>mean R^2 : 0.10203355611556783
mean MSE : 0.07885155943585756
</code></pre>
</div>
</div>
<div id="cdc38885" class="cell code" data-execution_count="47">
<div class="sourceCode" id="cb80"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;log_num_pages&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.0895027065116476
MSE : 0.07988824594846516
P-values sorted from largest to smallest:
log_t_count_per_year             2.175677e-02
log_t_count_per_day              2.175677e-02
log_t_count_per_log_num_pages    1.173573e-03
log_days_since_published         1.071437e-06
log_r_count                      6.002915e-08
is_eng                           1.752999e-08
log_r_count_per_log_day          1.508645e-09
log_t_count_per_num_pages        5.229754e-10
log_t_count                      3.743814e-11
log_t_count_per_log_day          1.087080e-11
const                            2.737318e-13
num_pages                        2.029396e-29
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="954d42b3" class="cell code" data-execution_count="48">
<div class="sourceCode" id="cb82"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>lgbmod_rsq_list <span class="op">=</span> []</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>lgbmod_mse_list <span class="op">=</span> []</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>):</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    lgbmod_rsq_list.append(rsq)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    lgbmod_mse_list.append(mse)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean R^2 : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_rsq_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean MSE : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_mse_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>mean R^2 : 0.10203355611556783
mean MSE : 0.07885155943585756
</code></pre>
</div>
</div>
<div id="74b14105" class="cell code" data-execution_count="49">
<div class="sourceCode" id="cb84"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;log_t_count_per_day&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.0895027065116476
MSE : 0.07988824594846516
P-values sorted from largest to smallest:
log_t_count_per_year             2.175677e-02
log_t_count_per_log_num_pages    1.173573e-03
log_days_since_published         1.071437e-06
log_r_count                      6.002915e-08
is_eng                           1.752999e-08
log_r_count_per_log_day          1.508645e-09
log_t_count_per_num_pages        5.229754e-10
log_t_count                      3.743814e-11
log_t_count_per_log_day          1.087080e-11
const                            2.737318e-13
num_pages                        2.029396e-29
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="f37447d5" class="cell code" data-execution_count="50">
<div class="sourceCode" id="cb86"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>lgbmod_rsq_list <span class="op">=</span> []</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>lgbmod_mse_list <span class="op">=</span> []</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>):</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    lgbmod_rsq_list.append(rsq)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    lgbmod_mse_list.append(mse)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean R^2 : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_rsq_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean MSE : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_mse_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>mean R^2 : 0.10203355611556783
mean MSE : 0.07885155943585756
</code></pre>
</div>
</div>
<div id="6cb237b1" class="cell code" data-execution_count="51">
<div class="sourceCode" id="cb88"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;log_t_count_per_year&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.08763687157160072
MSE : 0.08005195679269911
P-values sorted from largest to smallest:
log_t_count_per_log_num_pages    1.543837e-03
log_days_since_published         5.630554e-08
log_r_count                      2.527936e-08
is_eng                           1.602948e-08
log_t_count_per_num_pages        7.356205e-10
log_r_count_per_log_day          5.689125e-10
log_t_count                      5.504142e-10
log_t_count_per_log_day          1.466770e-10
const                            2.701388e-12
num_pages                        1.072581e-29
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="61616d66" class="cell code" data-execution_count="52">
<div class="sourceCode" id="cb90"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>lgbmod_rsq_list <span class="op">=</span> []</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>lgbmod_mse_list <span class="op">=</span> []</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>):</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    lgbmod_rsq_list.append(rsq)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    lgbmod_mse_list.append(mse)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean R^2 : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_rsq_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean MSE : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_mse_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>mean R^2 : 0.10345865107788456
mean MSE : 0.07872513633193194
</code></pre>
</div>
</div>
<div id="26914812" class="cell code" data-execution_count="53">
<div class="sourceCode" id="cb92"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;log_t_count_per_log_num_pages&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.0876182975820089
MSE : 0.08005358649929942
P-values sorted from largest to smallest:
log_days_since_published     6.603700e-08
log_r_count                  2.748145e-08
is_eng                       2.261780e-08
log_t_count                  6.547100e-09
log_r_count_per_log_day      6.330953e-10
log_t_count_per_log_day      1.605920e-10
const                        3.269658e-12
log_t_count_per_num_pages    3.031567e-23
num_pages                    5.536843e-76
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="7cdc3654" class="cell code" data-execution_count="54">
<div class="sourceCode" id="cb94"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>lgbmod_rsq_list <span class="op">=</span> []</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>lgbmod_mse_list <span class="op">=</span> []</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>):</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    lgbmod_rsq_list.append(rsq)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    lgbmod_mse_list.append(mse)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean R^2 : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_rsq_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean MSE : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_mse_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>mean R^2 : 0.10295244936835474
mean MSE : 0.07876642912306721
</code></pre>
</div>
</div>
<div id="9b904a12" class="cell code" data-execution_count="55">
<div class="sourceCode" id="cb96"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop([<span class="st">&#39;log_days_since_published&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R^2 : </span><span class="sc">{</span>rsq<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MSE : </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate p-values using statsmodels</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>X_with_constant <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_with_constant).fit()</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> ols_model.summary2().tables[<span class="dv">1</span>][<span class="st">&#39;P&gt;|t|&#39;</span>]</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort p-values from largest to smallest</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>sorted_p_values <span class="op">=</span> p_values.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P-values sorted from largest to smallest:&quot;</span>)</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_p_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R^2 : 0.09253101611716352
MSE : 0.07962253802785546
P-values sorted from largest to smallest:
log_r_count                  5.635720e-02
log_t_count                  3.090782e-03
log_r_count_per_log_day      2.372773e-03
log_t_count_per_log_day      1.770035e-04
is_eng                       8.369463e-08
log_t_count_per_num_pages    1.089519e-22
num_pages                    9.365021e-76
const                        0.000000e+00
Name: P&gt;|t|, dtype: float64
</code></pre>
</div>
</div>
<div id="2d91dfb5" class="cell code" data-execution_count="56">
<div class="sourceCode" id="cb98"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>lgbmod_rsq_list <span class="op">=</span> []</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>lgbmod_mse_list <span class="op">=</span> []</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>):</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    lgbmod_rsq_list.append(rsq)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    lgbmod_mse_list.append(mse)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean R^2 : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_rsq_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean MSE : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_mse_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>mean R^2 : 0.09756580319802405
mean MSE : 0.07923440822620915
</code></pre>
</div>
</div>
<div id="96a355bc" class="cell markdown">
<p>We see here that the p-value decreases relatively much while at the
same time, some of the remaining variables become less significant. It
is therefore natural to stop here, so to not simplify the model into one
that is not underfitted.</p>
<p>We keep the model where</p>
<p>log_days_since_published <br> log_r_count <br> log_t_count <br>
log_r_count_per_log_day <br> log_t_count_per_log_day <br> is_eng <br>
log_t_count_per_num_pages <br> num_pages</p>
<p>are the explanatory variables.</p>
<p>That is the previous model, the second to last one of those we have
just tested with respect to removing variables.</p>
</div>
<div id="7de6288e" class="cell markdown">
<p>We take a closer look at our new model</p>
</div>
<div id="15d4c222" class="cell code" data-execution_count="57">
<div class="sourceCode" id="cb100"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> df[[<span class="st">&#39;average_rating&#39;</span>, <span class="st">&quot;log_days_since_published&quot;</span>, <span class="st">&quot;log_r_count&quot;</span>, <span class="st">&quot;log_t_count&quot;</span>, <span class="st">&quot;log_r_count_per_log_day&quot;</span>, <span class="st">&quot;log_t_count_per_log_day&quot;</span>, <span class="st">&quot;is_eng&quot;</span>, <span class="st">&quot;log_t_count_per_num_pages&quot;</span>, <span class="st">&quot;num_pages&quot;</span>]]</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> df_final.corr()</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/4eb22518d72454807f56332e81e7e37b8fbb197e.png" /></p>
</div>
</div>
<div id="e4d63364" class="cell markdown">
<p>If we compare this with the correlation plot, we see that we have
some more variables with a relatively high correlation with
average_rating than what we had in the beginning, ref. the correlation
plot of df[["average_rating", "num_pages", "ratings_count",
"text_reviews_count"]]</p>
</div>
<div id="8a890e3c" class="cell code" data-execution_count="58">
<div class="sourceCode" id="cb101"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_final.iloc[:, <span class="dv">1</span>:df_final.shape[<span class="dv">1</span>]]</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_final[<span class="st">&#39;average_rating&#39;</span>]</span></code></pre></div>
</div>
<div id="f50ef81c" class="cell code" data-execution_count="59">
<div class="sourceCode" id="cb102"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>lgbmod_rsq_list <span class="op">=</span> []</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>lgbmod_mse_list <span class="op">=</span> []</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">1001</span>):</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> i)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    rsq, mse <span class="op">=</span> lgbmod(X_train, X_test, y_train, y_test)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    lgbmod_rsq_list.append(rsq)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    lgbmod_mse_list.append(mse)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean R^2 : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_rsq_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;mean MSE : </span><span class="sc">{</span>np<span class="sc">.</span>mean(lgbmod_mse_list)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>mean R^2 : 0.10170820727163742
mean MSE : 0.07695940214664815
</code></pre>
</div>
</div>
<div id="25f93426" class="cell code" data-execution_count="60">
<div class="sourceCode" id="cb104"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>plt.hist(lgbmod_rsq_list, bins<span class="op">=</span><span class="dv">50</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels and title</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;R^2&#39;</span>)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Histogram&#39;</span>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the histogram</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/6c3ca781b303c601a7281885d24b9f6f1f8ac066.png" /></p>
</div>
</div>
<div id="15aab8f4" class="cell code" data-execution_count="61">
<div class="sourceCode" id="cb105"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>plt.hist(lgbmod_mse_list, bins<span class="op">=</span><span class="dv">50</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels and title</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;MSE&#39;</span>)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Histogram&#39;</span>)</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the histogram</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5bf2c7dc02dc413787395370028e37ae/15def43cb0eb8062a66fcf706065713f717d6168.png" /></p>
</div>
</div>
<div id="33c9747a" class="cell code">
<div class="sourceCode" id="cb106"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
